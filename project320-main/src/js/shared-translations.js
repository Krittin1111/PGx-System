// Shared Language Translation System for PGx System
// This file contains common translations that can be used across all pages

const SHARED_TRANSLATIONS = {
    th: {
        // Dashboard
        'dashboard-title': 'PGX Dashboard',
        'loading-user': 'กำลังโหลด...',
        'user-fallback': 'ผู้ใช้งาน',
        'logout-confirm': 'คุณต้องการออกจากระบบหรือไม่?',
        'ok-button': 'ตกลง',
        'cancel-button': 'ยกเลิก',
        'confirm-button': 'ตกลง',
        'logout-success': 'ออกจากระบบสำเร็จ',
        
        // Navigation
        'nav-home': 'หน้าหลัก',
        'nav-register': 'ลงทะเบียนผู้ป่วย',
        'nav-send-test': 'ส่งตรวจ',
        'nav-record-results': 'บันทึกผลการทดสอบ',
        'nav-report': 'รายงานผล',
        'nav-quality': 'ควบคุมคุณภาพ',
        'nav-statistics': 'รายงานสถิติ',
        'nav-logout': 'ออกจากระบบ',
        
        // Common UI Elements
        'search-btn': 'ค้นหา',
        'save-btn': 'บันทึก',
        'cancel-btn': 'ยกเลิก',
        'edit-btn': 'แก้ไข',
        'delete-btn': 'ลบ',
        'add-btn': 'เพิ่ม',
        'close-btn': 'ปิด',
        'submit-btn': 'ส่ง',
        'reset-btn': 'รีเซ็ต',
        'back-btn': 'กลับ',
        'next-btn': 'ถัดไป',
        'previous-btn': 'ก่อนหน้า',
        'loading': 'กำลังโหลด...',
        'success': 'สำเร็จ',
        'error': 'เกิดข้อผิดพลาด',
        'warning': 'คำเตือน',
        'info': 'ข้อมูล',
        
        // Common Form Fields
        'name': 'ชื่อ',
        'lastname': 'นามสกุล',
        'age': 'อายุ',
        'gender': 'เพศ',
        'phone': 'เบอร์โทรศัพท์',
        'email': 'อีเมล',
        'password': 'รหัสผ่าน',
        'date': 'วันที่',
        'time': 'เวลา',
        'address': 'ที่อยู่',
        'note': 'หมายเหตุ',
        'description': 'รายละเอียด',
        
        // Status
        'active': 'ใช้งาน',
        'inactive': 'ไม่ใช้งาน',
        'pending': 'รอดำเนินการ',
        'approved': 'อนุมัติแล้ว',
        'rejected': 'ปฏิเสธ',
        'completed': 'เสร็จสิ้น',
        'in-progress': 'กำลังดำเนินการ',
        
        // Messages
        'no-data': 'ไม่มีข้อมูล',
        'data-saved': 'บันทึกข้อมูลสำเร็จ',
        'data-deleted': 'ลบข้อมูลสำเร็จ',
        'confirm-delete': 'คุณแน่ใจหรือไม่ที่จะลบข้อมูลนี้?',
        'please-select': 'ไม่ระบุ',
        'required-field': 'ช่องนี้จำเป็นต้องกรอก',
        'invalid-format': 'รูปแบบไม่ถูกต้อง',
        'connection-error': 'เกิดข้อผิดพลาดในการเชื่อมต่อ',
        
        // Admin Interface
        'admin-title': 'ผู้ดูแลระบบ',
        'user-list': 'รายชื่อผู้ใช้',
        'system-usage': 'การใช้งานระบบ',
        'general-settings': 'การตั้งค่าทั่วไป',
        'certificate-settings': 'การรับรองมาตรฐาน',
        'logout': 'ออกจากระบบ',
        'confirm-logout': 'คุณต้องการออกจากระบบหรือไม่?'
    },
    en: {
        // Dashboard
        'dashboard-title': 'PGX Dashboard',
        'loading-user': 'Loading...',
        'user-fallback': 'User',
        'logout-confirm': 'Do you want to logout?',
        'ok-button': 'OK',
        'cancel-button': 'Cancel',
        'confirm-button': 'Confirm',
        'logout-success': 'Logged out successfully',
        
        // Navigation
        'nav-home': 'Home',
        'nav-register': 'Patient Registration',
        'nav-send-test': 'Send Test',
        'nav-record-results': 'Record Test Results',
        'nav-report': 'Reports',
        'nav-quality': 'Quality Control',
        'nav-statistics': 'Statistics Report',
        'nav-logout': 'Logout',
        
        // Common UI Elements
        'search-btn': 'Search',
        'save-btn': 'Save',
        'cancel-btn': 'Cancel',
        'edit-btn': 'Edit',
        'delete-btn': 'Delete',
        'add-btn': 'Add',
        'close-btn': 'Close',
        'submit-btn': 'Submit',
        'reset-btn': 'Reset',
        'back-btn': 'Back',
        'next-btn': 'Next',
        'previous-btn': 'Previous',
        'loading': 'Loading...',
        'success': 'Success',
        'error': 'Error',
        'warning': 'Warning',
        'info': 'Information',
        
        // Common Form Fields
        'name': 'Name',
        'lastname': 'Last Name',
        'age': 'Age',
        'gender': 'Gender',
        'phone': 'Phone',
        'email': 'Email',
        'password': 'Password',
        'date': 'Date',
        'time': 'Time',
        'address': 'Address',
        'note': 'Note',
        'description': 'Description',
        
        // Status
        'active': 'Active',
        'inactive': 'Inactive',
        'pending': 'Pending',
        'approved': 'Approved',
        'rejected': 'Rejected',
        'completed': 'Completed',
        'in-progress': 'In Progress',
        
        // Messages
        'no-data': 'No data available',
        'data-saved': 'Data saved successfully',
        'data-deleted': 'Data deleted successfully',
        'confirm-delete': 'Are you sure you want to delete this data?',
        'please-select': 'Please select',
        'required-field': 'This field is required',
        'invalid-format': 'Invalid format',
        'connection-error': 'Connection error occurred',
        
        // Admin Interface
        'admin-title': 'Administrator',
        'user-list': 'User List',
        'system-usage': 'System Usage',
        'general-settings': 'General Settings',
        'certificate-settings': 'Certificate Settings',
        'logout': 'Logout',
        'confirm-logout': 'Are you sure you want to logout?'
    }
};

// Language management utility functions
class LanguageManager {
    constructor(pageSpecificTranslations = {}) {
        this.currentLanguage = localStorage.getItem('preferredLanguage') || 'th';
        this.translations = this.mergeTranslations(SHARED_TRANSLATIONS, pageSpecificTranslations);
        this.init();
    }

    mergeTranslations(shared, pageSpecific) {
        const merged = {};
        Object.keys(shared).forEach(lang => {
            merged[lang] = {
                ...shared[lang],
                ...(pageSpecific[lang] || {})
            };
        });
        return merged;
    }

    init() {
        this.initializeLanguageToggle();
        this.updateLanguage(this.currentLanguage);
    }

    initializeLanguageToggle() {
        console.log('Initializing language toggle...');
        const languageSwitch = document.getElementById('languageSwitch');
        const langOptions = document.querySelectorAll('.lang-option');

        if (!languageSwitch) {
            console.error('Language switch element not found!');
            return;
        }

        // Set initial language state
        this.updateSwitchPosition(this.currentLanguage);

        // Handle switch click
        languageSwitch.addEventListener('click', (e) => {
            console.log('Language switch clicked!');
            const newLanguage = this.currentLanguage === 'th' ? 'en' : 'th';
            this.switchLanguage(newLanguage);
        });

        // Handle individual option clicks
        langOptions.forEach(option => {
            option.addEventListener('click', (e) => {
                console.log('Individual language option clicked:', option.getAttribute('data-lang'));
                e.stopPropagation();
                const selectedLang = option.getAttribute('data-lang');
                
                if (selectedLang !== this.currentLanguage) {
                    this.switchLanguage(selectedLang);
                }
            });
        });
    }

    switchLanguage(newLanguage) {
        this.currentLanguage = newLanguage;
        localStorage.setItem('preferredLanguage', newLanguage);
        this.updateLanguage(newLanguage);
        this.updateSwitchPosition(newLanguage);
    }

    updateSwitchPosition(lang) {
        const languageSwitch = document.getElementById('languageSwitch');
        const langOptions = document.querySelectorAll('.lang-option');
        
        if (languageSwitch) {
            // Update switch class for slider position
            languageSwitch.className = `lang-switch ${lang}`;
            
            // Update active states
            langOptions.forEach(option => {
                option.classList.remove('active');
                if (option.getAttribute('data-lang') === lang) {
                    option.classList.add('active');
                }
            });
        }
    }

    updateLanguage(lang) {
        document.documentElement.lang = lang;
        
        // Update all elements with data-translate attribute
        document.querySelectorAll('[data-translate]').forEach(element => {
            const key = element.getAttribute('data-translate');
            if (this.translations[lang] && this.translations[lang][key]) {
                element.textContent = this.translations[lang][key];
            }
        });

        // Update placeholder attributes
        document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
            const key = element.getAttribute('data-translate-placeholder');
            if (this.translations[lang] && this.translations[lang][key]) {
                element.placeholder = this.translations[lang][key];
            }
        });
    }

    translate(key) {
        return this.translations[this.currentLanguage][key] || key;
    }

    getCurrentLanguage() {
        return this.currentLanguage;
    }
}

// Export for use in other files
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { SHARED_TRANSLATIONS, LanguageManager };
}